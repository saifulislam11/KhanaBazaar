---------------- ALL necessary triggers --------


CREATE OR REPLACE TRIGGER CUSTOMER_PHONE_LIMIT_EXCEEDS
    BEFORE INSERT
    ON CUSTOMER_PHONE
    FOR EACH ROW
DECLARE
    ID           CHAR(10);
    COUNTER      NUMBER;
    LOOP_COUNTER NUMBER;
BEGIN
    --DBMS_OUTPUT.PUT_LINE('HELLO');
    ID := :NEW.CUSTOMER_ID;
    SELECT COUNT(*) INTO COUNTER FROM CUSTOMER_PHONE WHERE CUSTOMER_ID = ID;
    LOOP_COUNTER := 1;
    IF COUNTER >= 2 THEN
        FOR RECORD IN (SELECT * FROM CUSTOMER_PHONE WHERE CUSTOMER_ID = ID )
            LOOP
                --DBMS_OUTPUT.PUT_LINE(RECORD.PHONE_NO);
                IF LOOP_COUNTER <> COUNTER THEN
                    DELETE FROM CUSTOMER_PHONE WHERE CUSTOMER_ID = ID AND PHONE_NO = RECORD.PHONE_NO;
                END IF;
                LOOP_COUNTER := LOOP_COUNTER + 1;

            end loop;
    end if;
END;
/